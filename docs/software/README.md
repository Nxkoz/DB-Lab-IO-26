# Реалізація інформаційного та програмного забезпечення

В рамках проєкту розробляється:
## SQL-скрипт для створення на початкового наповнення бази даних

```sql
-- MySQL Script generated by MySQL Workbench
-- Mon Apr 29 21:15:10 2024
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema DB-lab-IO-26
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema DB-lab-IO-26
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `DB-lab-IO-26` DEFAULT CHARACTER SET utf8 ;
USE `DB-lab-IO-26` ;

-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`permissions`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`permissions` (
  `Id` INT NOT NULL,
  `Permission` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`Id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`projects`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`projects` (
  `Id` INT NOT NULL,
  `Name` VARCHAR(50) NOT NULL,
  `Description` VARCHAR(100) NOT NULL,
  `Status` VARCHAR(20) NOT NULL,
  PRIMARY KEY (`Id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`payments`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`payments` (
  `Id` INT NOT NULL,
  `CardNumber` INT NOT NULL,
  `CardCVV` INT NOT NULL,
  `CardExpireDate` DATETIME NOT NULL,
  `Email` VARCHAR(50) NOT NULL,
  `ProjectId` INT NOT NULL,
  PRIMARY KEY (`Id`),
  INDEX `fk_payments_projects_idx` (`ProjectId` ASC) VISIBLE,
  CONSTRAINT `fk_payments_projects`
    FOREIGN KEY (`ProjectId`)
    REFERENCES `DB-lab-IO-26`.`projects` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`reles`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`reles` (
  `Id` INT NOT NULL,
  `Name` VARCHAR(30) NULL,
  PRIMARY KEY (`Id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`role_grant`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`role_grant` (
  `RoleID` INT NOT NULL,
  `PermissionId` INT NOT NULL,
  INDEX `fk_role_grant_reles1_idx` (`RoleID` ASC) VISIBLE,
  INDEX `fk_role_grant_permissions1_idx` (`PermissionId` ASC) VISIBLE,
  CONSTRAINT `fk_role_grant_reles1`
    FOREIGN KEY (`RoleID`)
    REFERENCES `DB-lab-IO-26`.`reles` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_role_grant_permissions1`
    FOREIGN KEY (`PermissionId`)
    REFERENCES `DB-lab-IO-26`.`permissions` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`reviews`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`reviews` (
  `Id` INT NOT NULL,
  `Text` VARCHAR(100) NOT NULL,
  `Rate` INT NOT NULL,
  `ProjectId` INT NOT NULL,
  PRIMARY KEY (`Id`),
  INDEX `fk_reviews_projects1_idx` (`ProjectId` ASC) VISIBLE,
  CONSTRAINT `fk_reviews_projects1`
    FOREIGN KEY (`ProjectId`)
    REFERENCES `DB-lab-IO-26`.`projects` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`tasks`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`tasks` (
  `Id` INT NOT NULL,
  `Name` VARCHAR(50) NOT NULL,
  `Developer` VARCHAR(45) NOT NULL,
  `Status` VARCHAR(20) NOT NULL,
  `Deadline` DATETIME NOT NULL,
  `ProjectId` INT NOT NULL,
  PRIMARY KEY (`Id`),
  INDEX `fk_tasks_projects1_idx` (`ProjectId` ASC) VISIBLE,
  CONSTRAINT `fk_tasks_projects1`
    FOREIGN KEY (`ProjectId`)
    REFERENCES `DB-lab-IO-26`.`projects` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`users`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`users` (
  `Id` INT NOT NULL,
  `Login` VARCHAR(45) NOT NULL,
  `Picture` MEDIUMBLOB NOT NULL,
  `Password` BLOB NOT NULL,
  `Email` VARCHAR(50) NOT NULL,
  `Role` VARCHAR(30) NOT NULL,
  PRIMARY KEY (`Id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`members`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`members` (
  `Id` INT NOT NULL,
  `RoleId` INT NOT NULL,
  `UserId` INT NOT NULL,
  PRIMARY KEY (`Id`),
  INDEX `fk_members_users1_idx` (`RoleId` ASC) VISIBLE,
  INDEX `fk_members_reles1_idx` (`UserId` ASC) VISIBLE,
  CONSTRAINT `fk_members_users1`
    FOREIGN KEY (`RoleId`)
    REFERENCES `DB-lab-IO-26`.`users` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_members_reles1`
    FOREIGN KEY (`UserId`)
    REFERENCES `DB-lab-IO-26`.`reles` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`projects_members`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`projects_members` (
  `MemberID` INT NOT NULL,
  `ProjectId` INT NOT NULL,
  INDEX `fk_projects_members_projects1_idx` (`MemberID` ASC) VISIBLE,
  INDEX `fk_projects_members_members1_idx` (`ProjectId` ASC) VISIBLE,
  CONSTRAINT `fk_projects_members_projects1`
    FOREIGN KEY (`MemberID`)
    REFERENCES `DB-lab-IO-26`.`projects` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_projects_members_members1`
    FOREIGN KEY (`ProjectId`)
    REFERENCES `DB-lab-IO-26`.`members` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`permissions`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`permissions` (`Id`, `Permission`) VALUES (1, 'Read');
INSERT INTO `DB-lab-IO-26`.`permissions` (`Id`, `Permission`) VALUES (2, 'Write');
INSERT INTO `DB-lab-IO-26`.`permissions` (`Id`, `Permission`) VALUES (3, 'Execute');

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`projects`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`projects` (`Id`, `Name`, `Description`, `Status`) VALUES (1, 'Project A', 'Description for Project A', 'Active');
INSERT INTO `DB-lab-IO-26`.`projects` (`Id`, `Name`, `Description`, `Status`) VALUES (2, 'Project B', 'Description for Project B', 'Inactive');
INSERT INTO `DB-lab-IO-26`.`projects` (`Id`, `Name`, `Description`, `Status`) VALUES (3, 'Project C', 'Description for Project C', 'Pending');

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`payments`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`payments` (`Id`, `CardNumber`, `CardCVV`, `CardExpireDate`, `Email`, `ProjectId`) VALUES (1, 123456, 123, '2024-04-26', 'payment1@example.com', 1);
INSERT INTO `DB-lab-IO-26`.`payments` (`Id`, `CardNumber`, `CardCVV`, `CardExpireDate`, `Email`, `ProjectId`) VALUES (2, 112233, 456, '2024-04-27', 'payment2@example.com', 2);
INSERT INTO `DB-lab-IO-26`.`payments` (`Id`, `CardNumber`, `CardCVV`, `CardExpireDate`, `Email`, `ProjectId`) VALUES (3, 123424, 789, '2024-04-29', 'payment3@example.com', 3);

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`reles`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`reles` (`Id`, `Name`) VALUES (1, 'Teamlead');
INSERT INTO `DB-lab-IO-26`.`reles` (`Id`, `Name`) VALUES (2, 'Developer');
INSERT INTO `DB-lab-IO-26`.`reles` (`Id`, `Name`) VALUES (3, 'Admin');

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`role_grant`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`role_grant` (`RoleID`, `PermissionId`) VALUES (1, 1);
INSERT INTO `DB-lab-IO-26`.`role_grant` (`RoleID`, `PermissionId`) VALUES (1, 2);
INSERT INTO `DB-lab-IO-26`.`role_grant` (`RoleID`, `PermissionId`) VALUES (2, 1);
INSERT INTO `DB-lab-IO-26`.`role_grant` (`RoleID`, `PermissionId`) VALUES (2, 3);
INSERT INTO `DB-lab-IO-26`.`role_grant` (`RoleID`, `PermissionId`) VALUES (3, 2);
INSERT INTO `DB-lab-IO-26`.`role_grant` (`RoleID`, `PermissionId`) VALUES (3, 3);

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`reviews`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`reviews` (`Id`, `Text`, `Rate`, `ProjectId`) VALUES (1, 'Good project!', 5, 1);
INSERT INTO `DB-lab-IO-26`.`reviews` (`Id`, `Text`, `Rate`, `ProjectId`) VALUES (2, 'Could be better', 3, 2);
INSERT INTO `DB-lab-IO-26`.`reviews` (`Id`, `Text`, `Rate`, `ProjectId`) VALUES (3, 'Excellent work', 5, 3);

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`tasks`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`tasks` (`Id`, `Name`, `Developer`, `Status`, `Deadline`, `ProjectId`) VALUES (1, 'Task 1', 'dev_user1', 'In Progress', '2024-04-25', 1);
INSERT INTO `DB-lab-IO-26`.`tasks` (`Id`, `Name`, `Developer`, `Status`, `Deadline`, `ProjectId`) VALUES (2, 'Task 2', 'dev_user2', 'To Do', '2024-04-28', 2);
INSERT INTO `DB-lab-IO-26`.`tasks` (`Id`, `Name`, `Developer`, `Status`, `Deadline`, `ProjectId`) VALUES (3, 'Task 3', 'dev_user3', 'Completed', '2024-04-29', 3);

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`users`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`users` (`Id`, `Login`, `Picture`, `Password`, `Email`, `Role`) VALUES (1, 'admin_user', admin_picture_blob, admin_password_blob, 'admin@example.com', 'Teamlead');
INSERT INTO `DB-lab-IO-26`.`users` (`Id`, `Login`, `Picture`, `Password`, `Email`, `Role`) VALUES (2, 'dev_user1', dev_picture_blob1, dev_password_blob1, 'dev1@example.com', 'Developer');
INSERT INTO `DB-lab-IO-26`.`users` (`Id`, `Login`, `Picture`, `Password`, `Email`, `Role`) VALUES (3, 'dev_user2', dev_picture_blob2, dev_password_blob2, 'dev2@example.com', 'Developer');
INSERT INTO `DB-lab-IO-26`.`users` (`Id`, `Login`, `Picture`, `Password`, `Email`, `Role`) VALUES (4, 'manager_user', manager_picture_blob, manager_password_blob, 'manager@example.com', 'Admin');

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`members`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`members` (`Id`, `RoleId`, `UserId`) VALUES (1, 1, 1);
INSERT INTO `DB-lab-IO-26`.`members` (`Id`, `RoleId`, `UserId`) VALUES (2, 2, 2);
INSERT INTO `DB-lab-IO-26`.`members` (`Id`, `RoleId`, `UserId`) VALUES (3, 2, 3);
INSERT INTO `DB-lab-IO-26`.`members` (`Id`, `RoleId`, `UserId`) VALUES (4, 3, 4);

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`projects_members`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`projects_members` (`MemberID`, `ProjectId`) VALUES (1, 1);
INSERT INTO `DB-lab-IO-26`.`projects_members` (`MemberID`, `ProjectId`) VALUES (2, 1);
INSERT INTO `DB-lab-IO-26`.`projects_members` (`MemberID`, `ProjectId`) VALUES (3, 2);
INSERT INTO `DB-lab-IO-26`.`projects_members` (`MemberID`, `ProjectId`) VALUES (4, 3);

COMMIT;

```

## RESTfull сервіс для управління даними  

### Моделі бази даних


```cs
public partial class Member
{
    public int Id { get; set; }

    public int RoleId { get; set; }

    public int UserId { get; set; }

    [ForeignKey("RoleId")]
    public virtual Role Role { get; set; } = null!;

    [ForeignKey("UserId")]
    public virtual User User { get; set; } = null!;
}

public partial class Payment
{
    public int Id { get; set; }

    public int CardNumber { get; set; }

    public int CardCvv { get; set; }

    public DateTime CardExpireDate { get; set; }

    public string Email { get; set; } = null!;

    public int ProjectId { get; set; }

    [ForeignKey("ProjectId")]
    public virtual Project Project { get; set; } = null!;
}

public partial class Permission
{
    public int Id { get; set; }

    public string Permission1 { get; set; } = null!;
}

public partial class Project
{
    public int Id { get; set; }

    public string Name { get; set; } = null!;

    public string Description { get; set; } = null!;

    public string Status { get; set; } = null!;

    public virtual ICollection<Payment> Payments { get; set; } = new List<Payment>();

    public virtual ICollection<Review> Reviews { get; set; } = new List<Review>();

    public virtual ICollection<Task> Tasks { get; set; } = new List<Task>();
}

public partial class ProjectsMember
{
    public int MemberId { get; set; }

    public int ProjectId { get; set; }

    [ForeignKey("MemberId")]
    public virtual Member Member { get; set; } = null!;

    [ForeignKey("ProjectId")]
    public virtual Project Project { get; set; } = null!;
}

public partial class Review
{
    public int Id { get; set; }

    public string Text { get; set; } = null!;

    public int Rate { get; set; }

    public int ProjectId { get; set; }

    [ForeignKey("ProjectId")]
    public virtual Project Project { get; set; } = null!;
}

public partial class Role
{
    public int Id { get; set; }

    public string? Name { get; set; }

    public virtual ICollection<Member> Members { get; set; } = new List<Member>();
}

public partial class RoleGrant
{
    public int RoleId { get; set; }

    public int PermissionId { get; set; }

    [ForeignKey("PermissionId")]
    public virtual Permission Permission { get; set; } = null!;

    [ForeignKey("RoleId")]
    public virtual Role Role { get; set; } = null!;
}

public partial class Task
{
    public int Id { get; set; }

    public string Name { get; set; } = null!;

    public string Developer { get; set; } = null!;

    public string Status { get; set; } = null!;

    public DateTime Deadline { get; set; }

    public int ProjectId { get; set; }

    [ForeignKey("ProjectId")]
    public virtual Project Project { get; set; } = null!;
}

public partial class User
{
    public int Id { get; set; }

    public string Login { get; set; } = null!;

    public byte[] Picture { get; set; } = null!;

    public byte[] Password { get; set; } = null!;

    public string Email { get; set; } = null!;

    public string Role { get; set; } = null!;

    public virtual ICollection<Member> Members { get; set; } = new List<Member>();
}
```

### Контекст бази даних

```cs
public partial class ProjectDbContext : DbContext
{
    public ProjectDbContext()
    {
    }

    public ProjectDbContext(DbContextOptions<ProjectDbContext> options)
        : base(options)
    {
    }

    public virtual DbSet<Member> Members { get; set; }

    public virtual DbSet<Payment> Payments { get; set; }

    public virtual DbSet<Permission> Permissions { get; set; }

    public virtual DbSet<Project> Projects { get; set; }

    public virtual DbSet<ProjectsMember> ProjectsMembers { get; set; }

    public virtual DbSet<Review> Reviews { get; set; }

    public virtual DbSet<Role> Roles { get; set; }

    public virtual DbSet<RoleGrant> RoleGrants { get; set; }

    public virtual DbSet<Models.Task> Tasks { get; set; }

    public virtual DbSet<User> Users { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        => optionsBuilder.UseMySql("server=localhost;user=root;password=zxcfvb05D;database=project_db", ServerVersion.Parse("8.0.35-mysql"));

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder
            .UseCollation("utf8mb4_0900_ai_ci")
            .HasCharSet("utf8mb4");

        modelBuilder.Entity<Member>(entity =>
        {
            entity.HasKey(e => e.Id).HasName("PRIMARY");

            entity.ToTable("members");

            entity.HasIndex(e => e.Id, "Id").IsUnique();

            entity.HasIndex(e => e.RoleId, "roleFK_idx");

            entity.HasIndex(e => e.UserId, "userFK_idx");

            entity.HasOne(d => d.Role).WithMany(p => p.Members)
                .HasForeignKey(d => d.RoleId)
                .OnDelete(DeleteBehavior.ClientSetNull)
                .HasConstraintName("roleFK");

            entity.HasOne(d => d.User).WithMany(p => p.Members)
                .HasForeignKey(d => d.UserId)
                .OnDelete(DeleteBehavior.ClientSetNull)
                .HasConstraintName("userFK");
        });

        modelBuilder.Entity<Payment>(entity =>
        {
            entity.HasKey(e => e.Id).HasName("PRIMARY");

            entity.ToTable("payments");

            entity.HasIndex(e => e.Id, "Id").IsUnique();

            entity.HasIndex(e => e.ProjectId, "ProjectId");

            entity.Property(e => e.CardCvv).HasColumnName("CardCVV");
            entity.Property(e => e.CardExpireDate).HasColumnType("datetime");
            entity.Property(e => e.Email).HasMaxLength(50);

            entity.HasOne(d => d.Project).WithMany(p => p.Payments)
                .HasForeignKey(d => d.ProjectId)
                .OnDelete(DeleteBehavior.ClientSetNull)
                .HasConstraintName("payments_ibfk_1");
        });

        modelBuilder.Entity<Permission>(entity =>
        {
            entity.HasKey(e => e.Id).HasName("PRIMARY");

            entity.ToTable("permissions");

            entity.HasIndex(e => e.Id, "Id").IsUnique();

            entity.Property(e => e.Permission1)
                .HasMaxLength(50)
                .HasColumnName("Permission");
        });

        modelBuilder.Entity<Project>(entity =>
        {
            entity.HasKey(e => e.Id).HasName("PRIMARY");

            entity.ToTable("projects");

            entity.HasIndex(e => e.Id, "Id").IsUnique();

            entity.Property(e => e.Description).HasMaxLength(100);
            entity.Property(e => e.Name).HasMaxLength(50);
            entity.Property(e => e.Status).HasMaxLength(20);
        });

        modelBuilder.Entity<ProjectsMember>(entity =>
        {
            entity
                .HasNoKey()
                .ToTable("projects_members");

            entity.HasIndex(e => e.MemberId, "MemberId");

            entity.HasIndex(e => e.ProjectId, "ProjectId");

            entity.HasOne(d => d.Member).WithMany()
                .HasForeignKey(d => d.MemberId)
                .OnDelete(DeleteBehavior.ClientSetNull)
                .HasConstraintName("projects_members_ibfk_2");

            entity.HasOne(d => d.Project).WithMany()
                .HasForeignKey(d => d.ProjectId)
                .OnDelete(DeleteBehavior.ClientSetNull)
                .HasConstraintName("projects_members_ibfk_1");
        });

        modelBuilder.Entity<Review>(entity =>
        {
            entity.HasKey(e => e.Id).HasName("PRIMARY");

            entity.ToTable("reviews");

            entity.HasIndex(e => e.Id, "Id").IsUnique();

            entity.HasIndex(e => e.ProjectId, "ProjectId");

            entity.Property(e => e.Text).HasMaxLength(100);

            entity.HasOne(d => d.Project).WithMany(p => p.Reviews)
                .HasForeignKey(d => d.ProjectId)
                .OnDelete(DeleteBehavior.ClientSetNull)
                .HasConstraintName("reviews_ibfk_1");
        });

        modelBuilder.Entity<Role>(entity =>
        {
            entity.HasKey(e => e.Id).HasName("PRIMARY");

            entity.ToTable("roles");

            entity.HasIndex(e => e.Id, "Id").IsUnique();

            entity.HasIndex(e => e.Name, "Name").IsUnique();

            entity.Property(e => e.Name).HasMaxLength(30);
        });

        modelBuilder.Entity<RoleGrant>(entity =>
        {
            entity
                .HasNoKey()
                .ToTable("role_grant");

            entity.HasIndex(e => e.PermissionId, "PermissionId");

            entity.HasIndex(e => e.RoleId, "RoleId");

            entity.HasOne(d => d.Permission).WithMany()
                .HasForeignKey(d => d.PermissionId)
                .OnDelete(DeleteBehavior.ClientSetNull)
                .HasConstraintName("role_grant_ibfk_2");

            entity.HasOne(d => d.Role).WithMany()
                .HasForeignKey(d => d.RoleId)
                .OnDelete(DeleteBehavior.ClientSetNull)
                .HasConstraintName("role_grant_ibfk_1");
        });

        modelBuilder.Entity<Models.Task>(entity =>
        {
            entity.HasKey(e => e.Id).HasName("PRIMARY");

            entity.ToTable("tasks");

            entity.HasIndex(e => e.Id, "Id").IsUnique();

            entity.HasIndex(e => e.ProjectId, "ProjectId");

            entity.Property(e => e.Deadline).HasColumnType("datetime");
            entity.Property(e => e.Developer).HasMaxLength(45);
            entity.Property(e => e.Name).HasMaxLength(50);
            entity.Property(e => e.Status).HasMaxLength(20);

            entity.HasOne(d => d.Project).WithMany(p => p.Tasks)
                .HasForeignKey(d => d.ProjectId)
                .OnDelete(DeleteBehavior.ClientSetNull)
                .HasConstraintName("tasks_ibfk_1");
        });

        modelBuilder.Entity<User>(entity =>
        {
            entity.HasKey(e => e.Id).HasName("PRIMARY");

            entity.ToTable("users");

            entity.HasIndex(e => e.Email, "Email").IsUnique();

            entity.HasIndex(e => e.Id, "Id").IsUnique();

            entity.HasIndex(e => e.Login, "Login").IsUnique();

            entity.Property(e => e.Email).HasMaxLength(50);
            entity.Property(e => e.Login).HasMaxLength(45);
            entity.Property(e => e.Password).HasColumnType("blob");
            entity.Property(e => e.Picture).HasColumnType("mediumblob");
            entity.Property(e => e.Role).HasMaxLength(30);
        });

        OnModelCreatingPartial(modelBuilder);
    }

    partial void OnModelCreatingPartial(ModelBuilder modelBuilder);
}
```

### Вхідний файл програми 
```cs
public class Program
    {
        public static void Main(string[] args)
        {
            var builder = WebApplication.CreateBuilder(args);

            string connectionString = builder.Configuration.GetConnectionString("MainConnectionString")
                ?? throw new InvalidOperationException("Connection string 'ProjectDbContext' not found.");

            builder.Services.AddDbContext<ProjectDbContext>(options =>
                options.UseMySql(connectionString, ServerVersion.AutoDetect(connectionString)));

            var configuration = new ConfigurationBuilder().AddJsonFile("appsettings.json").Build();
            builder.Services.AddSingleton<IConfigurationRoot>(option => {
                return configuration;
            });

            builder.Services.AddControllers()
                .AddNewtonsoftJson(options =>
                {
                    options.SerializerSettings.ReferenceLoopHandling = Newtonsoft.Json.ReferenceLoopHandling.Ignore;
                });

            builder.Services.AddEndpointsApiExplorer();
            builder.Services.AddSwaggerGen(options =>
            {
                var xmlFilename = $"{Assembly.GetExecutingAssembly().GetName().Name}.xml";
                options.IncludeXmlComments(Path.Combine(AppContext.BaseDirectory, xmlFilename));
            });

            var app = builder.Build();

            if (app.Environment.IsDevelopment())
            {
                app.UseSwagger();
                app.UseSwaggerUI();
            }

            app.UseAuthorization();

            app.MapControllers();

            app.Run();
        }
    }
```

###  реалізація CRUD 

#### ProjectsController

```cs
[Route("api/projects")]
[ApiController]
public class ProjectsController : ControllerBase
{
    private readonly ProjectDbContext _context;

    public ProjectsController(ProjectDbContext context)
    {
        _context = context;
    }

    /// <summary>
    ///     Retrieves all projects
    /// </summary>
    /// <response code="200"> Project list </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpGet]
    public async Task<ActionResult<IEnumerable<ProjectResponse>>> GetProjects()
    {
        try
        {
            var projects = await System.Threading.Tasks.Task.Run(() =>
                _context.Projects
                    .Select(ProjectResponse.ConvertFromModel)
                    .ToList()
            );

            return projects;
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    ///     Retrieves a specific project by unique id
    /// </summary>
    /// <response code="200"> Specific Project </response>
    /// <response code="400"> InvalidIndexError: Project with such Id does not exist </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpGet("{projectId:int}")]
    public async Task<ActionResult<ProjectResponse>> GetProject(int projectId)
    {
        try
        {
            var project = await _context.Projects.FirstAsync(p => p.Id == projectId);

            if (project == null)
            {
                return BadRequest("InvalidIndexError: Project with such Id does not exist");
            }

            return ProjectResponse.ConvertFromModel(project);
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    ///     Update specific values for project by unique id
    /// </summary>
    /// <remarks>
    /// Sample request:
    ///     [
    ///       {
    ///         "op":"replace",
    ///         "path":"/{parameter name}",
    ///         "value": "{parameter value}"
    ///       }
    ///     ]
    ///     
    /// </remarks>
    /// <response code="200"> An updated Project </response>
    /// <response code="400"> InvalidIndexError: Project with such Id does not exist </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpPatch("{projectId:int}")]
    public async Task<ActionResult<ProjectResponse>> PatchProject(
        int projectId, 
        [FromBody] JsonPatchDocument<Project> patchDoc)
    {
        try
        {
            var project = await _context.Projects.FirstAsync(p => p.Id == projectId);

            if (project == null)
            {
                return BadRequest("InvalidIndexError: Project with such Id does not exist");
            }

            patchDoc.ApplyTo(project, ModelState);
            await _context.SaveChangesAsync();

            return RedirectToAction("GetProject", new { projectId });
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    /// Add Project to db
    /// </summary>
    /// <response code="200"> A newly created Project </response>
    /// <response code="400">
    ///     DuplicateProjectNameError: project with such name already exists&#xA;
    ///     InvalidIndexError: Project with such Id does not exist
    /// </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpPost]
    public async Task<ActionResult<ProjectResponse>> CreateProject([FromBody] ProjectDTO projectDTO)
    {
        try
        {
            if (await _context.Projects.FirstOrDefaultAsync(p => p.Name == projectDTO.Name) != null)
            {
                return BadRequest("DuplicateProjectNameError: project with such name already exists");
            }

            var entityEntry = _context.Projects.Add(projectDTO.ToModel());
            await _context.SaveChangesAsync();

            return RedirectToAction("GetProject", new { projectId = entityEntry.Entity.Id });
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    ///     Remove Project from db by unique id
    /// </summary>
    /// <response code="200"> Just removed Project </response>
    /// <response code="400"> InvalidIndexError: Project with such Id does not exist </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpDelete("{projectId:int}")]
    public async Task<ActionResult<ProjectResponse>> DeleteProject(int projectId)
    {
        try
        {
            var project = await _context.Projects
                .Include(p => p.Tasks)
                .Include(p => p.Payments)
                .Include(p => p.Reviews)
                .FirstAsync(p => p.Id == projectId);

            if (project == null)
            {
                return BadRequest("InvalidIndexError: Project with such Id does not exist");
            }

            _context.Projects.Remove(project);
            await _context.SaveChangesAsync();

            return ProjectResponse.ConvertFromModel(project);
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    ///     Retrieves reviews related to specific project
    /// </summary>
    /// <response code="200"> List of reviews </response>
    /// <response code="400">
    ///     InvalidIndexError: Project with such Id does not exist&#xA;
    ///     Selected project is not finished
    /// </response>
    /// <response code="500"> Internal Server Error </response>
        
    [HttpGet("{projectId:int}/reviews")]
    public async Task<ActionResult<IEnumerable<ReviewResponse>>> GetProjectReviews(int projectId)
    {
        try
        {
            var project = await _context.Projects
                    .Include(p => p.Reviews)
                    .FirstOrDefaultAsync(p => p.Id == projectId);
            if (project == null)
            {
                return BadRequest("InvalidIndexError: Project with such Id does not exist");
            }

            if (project.Status != "Finished")
            {
                return BadRequest("Selected project is not finished");
            }

            return project.Reviews.Select(ReviewResponse.ConvertFromModel).ToList();
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    ///     Add review to specific project
    /// </summary>
    /// <response code="200"> List of reviews </response>
    /// <response code="400">
    ///     InvalidIndexError: Project with such Id does not exist&#xA;
    ///     InvalidIndexError: Project id in review and parameter are different&#xA;
    ///     Selected project is not finished
    /// </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpPost("{projectId:int}/reviews")]
    public async Task<ActionResult<IEnumerable<Review>>> AddReview(
        int projectId, 
        [FromBody] ReviewDTO reviewDTO)
    {
        try
        {
            var project = await _context.Projects.FindAsync(projectId);

            if (project == null) return BadRequest("InvalidIndexError: Project with such Id does not exist");

            if (project.Status != "Finished") return BadRequest("Selected project is not finished");

            _context.Reviews.Add(reviewDTO.ToModel());
            await _context.SaveChangesAsync();

            return RedirectToAction("GetProjectReviews", new { projectId });
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }
}
```

#### Response для проєкту

```cs
public class ProjectResponse
{
    public int Id { get; set; }

    public string Name { get; set; } = null!;

    public string Description { get; set; } = null!;

    public string Status { get; set; } = null!;

    public static ProjectResponse ConvertFromModel(Project project)
    {
        return new ProjectResponse()
        {
            Id = project.Id,
            Description = project.Description,
            Status = project.Status,
            Name = project.Name
        };
    }
}
```

#### DTO для створення проєкту 
```cs
public class ProjectDTO
{
    public string Name { get; set; } = null!;

    public string Description { get; set; } = null!;

    public string Status { get; set; } = null!;

    public Project ToModel() =>  new Project { Name = Name, Description = Description, Status = Status };
}
```

#### Response для відгуку

```cs
public class ReviewResponse
    {
        public int Id { get; set; }

        public string Text { get; set; } = null!;

        public int Rate { get; set; }

        public static ReviewResponse ConvertFromModel(Review review)
        {
            return new ReviewResponse() { Id = review.Id, Text = review.Text, Rate = review.Rate };
        }
    }
```

#### DTO для створення відгуку

```cs
public class ReviewDTO
{
    public string Text { get; set; } = null!;

    public int Rate { get; set; }

    public Review ToModel() => new Review() { Text = Text, Rate = Rate };
}
```

#### TaskController 

```cs
[Route("api/tasks")]
[ApiController]
public class TasksController : ControllerBase
{
    private readonly ProjectDbContext _context;

    public TasksController(ProjectDbContext context)
    {
        _context = context;
    }

    /// <summary>
    ///     Retrieves tasks related to specific project
    /// </summary>
    /// <response code="200"> List of tasks </response>
    /// <response code="400"> InvalidIndexError: Project with such Id does not exist </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpGet]
    public async Task<ActionResult<IEnumerable<TaskResponse>>> GetTasks(
        [FromQuery(Name = "projectId")] int projectId)
    {
        try
        {
            var project = await _context.Projects
                .Include(p => p.Tasks)
                .FirstOrDefaultAsync(p => p.Id == projectId);
            if (project == null)
            {
                return BadRequest("InvalidIndexError: Project with such Id does not exist");
            }

            return project.Tasks.Select(TaskResponse.ConvertFromModel).ToList();
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    ///     Retrieves specific task by unique id
    /// </summary>
    /// <response code="200"> Specific Task </response>
    /// <response code="400">  InvalidIndexError: Task with such Id does not exist </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpGet("{taskId:int}")]
    public async Task<ActionResult<TaskResponse>> GetTask(int taskId)
    {
        try
        {
            var task = await _context.Tasks.FirstAsync(t => t.Id == taskId);

            if (task == null) return BadRequest("InvalidIndexError: Task with such Id does not exist");

            return TaskResponse.ConvertFromModel(task);
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    ///     Update specific values for task by unique id
    /// </summary>
    /// <remarks>
    /// Sample request:
    ///     [
    ///       {
    ///         "op":"replace",
    ///         "path":"/{parameter name}",
    ///         "value": "{parameter value}"
    ///       }
    ///     ]
    ///     
    /// </remarks>
    /// <response code="200"> An updated Task </response>
    /// <response code="400"> InvalidIndexError: Task with such Id does not exist </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpPatch("{taskId:int}")]
    public async Task<ActionResult<TaskResponse>> PatchTask(
        int taskId,
        [FromBody] JsonPatchDocument<Models.Task> patchDoc)
    {
        var task = await _context.Tasks.FindAsync(taskId);
        if (task == null)
        {
            return BadRequest("InvalidIndexError: Task with such Id does not exist");
        }

        patchDoc.ApplyTo(task, ModelState);
        _context.SaveChanges();

        return RedirectToAction("GetTask", new { taskId });
    }

    /// <summary>
    ///     Add Task to db
    /// </summary>
    /// <response code="200"> A newly created Task </response>
    /// <response code="400"> InvalidIndexError: Project with such Id does not exist </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpPost]
    public async Task<ActionResult<TaskResponse>> CreateTask(
        [FromQuery] int projectId,
        [FromBody] TaskDTO taskDTO)
    {
        try
        {
            if (!await _context.Projects.AnyAsync(p => p.Id == projectId))
            {
                return BadRequest("InvalidIndexError: Project with such Id does not exist");
            }

            var task = taskDTO.ToModel();
            task.ProjectId = projectId;

            var entityEntry = _context.Tasks.Add(task);
            await _context.SaveChangesAsync();

            return RedirectToAction("GetTask", new { taskId = entityEntry.Entity.Id });
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    ///     Remove Task from db by unique id
    /// </summary>
    /// <response code="200"> Just removed Task </response>
    /// <response code="400"> InvalidIndexError: Task with such Id does not exist </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpDelete("{taskId:int}")]
    public async Task<ActionResult<TaskResponse>> DeleteTask(int taskId)
    {
        try
        {
            var task = await _context.Tasks.FindAsync(taskId);
            if (task == null)
            {
                return BadRequest("InvalidIndexError: Task with such Id does not exist");
            }

            _context.Tasks.Remove(task);
            await _context.SaveChangesAsync();

            return TaskResponse.ConvertFromModel(task);
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }
}
```

#### Response для завдання

```cs
public class TaskResponse
{
    public int Id { get; set; }

    public string Name { get; set; } = null!;

    public string Developer { get; set; } = null!;

    public string Status { get; set; } = null!;

    public DateTime Deadline { get; set; }

    public static TaskResponse ConvertFromModel(Models.Task task)
    {
        return new TaskResponse
        {
            Id = task.Id,
            Name = task.Name,
            Developer = task.Developer,
            Status = task.Status,
            Deadline = task.Deadline
        };
    }
}
```

#### DTO для створення завдання

```cs
public class TaskDTO
{
    public string Name { get; set; } = null!;

    public string Developer { get; set; } = null!;

    public string Status { get; set; } = null!;

    public DateTime Deadline { get; set; }

    public Models.Task ToModel() => new Models.Task
    {
        Name = Name,
        Developer = Developer,
        Status = Status,
        Deadline = Deadline
    };
}
```

#### UsersController

```cs
[Route("api/users")]
[ApiController]
public class UsersController : ControllerBase
{
    private readonly ProjectDbContext _context;

    public UsersController(ProjectDbContext context)
    {
        _context = context;
    }

    /// <summary>
    ///     Retrieves all users related to a specific Project
    /// </summary>
    /// <response code="200"> Users list </response>
    /// <response code="400"> InvalidIndexError: Project with such Id does not exist </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpGet]
    public async Task<ActionResult<IEnumerable<UserResponse>>> GetUsers([FromQuery] int projectId)
    {
        try
        {
            var project = await _context.Projects.FindAsync(projectId);

            if (project == null)
            {
                return BadRequest($"InvalidIndexError: Project with such Id does not exist");
            }

            return (await GetProjectUsers(project.Id)).Select(UserResponse.ConvertFromModel).ToList();
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    ///     Retrieves specific User by unique Id
    /// </summary>
    /// <response code="200"> Specific User </response>
    /// <response code="400"> InvalidIndexError: User with such Id does not exist </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpGet("{userId}")]
    public async Task<ActionResult<UserResponse>> GetUser(int userId)
    {
        try
        {
            var user = await _context.Users.FindAsync(userId);

            if (user == null)
            {
                return BadRequest($"InvalidIndexError: User with such Id does not exist");
            }

            return UserResponse.ConvertFromModel(user);
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    ///     Update specific values for user by unique id
    /// </summary>
    /// <remarks>
    /// Sample request:
    ///     [
    ///       {
    ///         "op":"replace",
    ///         "path":"/{parameter name}",
    ///         "value": "{parameter value}"
    ///       }
    ///     ]
    ///     
    /// </remarks>
    /// <response code="200"> An updated User </response>
    /// <response code="400"> InvalidIndexError: User with such Id does not exist </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpPatch("{userId:int}")]
    public async Task<ActionResult<UserResponse>> PatchUser(
        int userId,
        [FromBody] JsonPatchDocument<User> patchDoc)
    {
        try
        {
            var user = await _context.Users.FindAsync(userId);

            if (user == null)
            {
                return BadRequest("InvalidIndexError: User with such Id does not exist");
            }

            patchDoc.ApplyTo(user, ModelState);
            await _context.SaveChangesAsync();

            return RedirectToAction("GetUser", new { userId });
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    ///     Connect user to specific project
    /// </summary>
    /// <response code="201"> User connected successfully. Member Id: {memberId} </response>
    /// <response code="400">
    ///     InvalidIndexError: User with such Id does not exist&#xA;
    ///     InvalidIndexError: Project with such name does not exist&#xA;
    ///     DuplicateProjectMember: User with such Id already connected to selected project&#xA;
    ///     InvalidNameError: Role with such name does not exist
    /// </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpPost("{userId:int}/projects/{projectId:int}")]
    public async Task<IActionResult> PostUser(
        [FromQuery] string roleName,
        int userId,
        int projectId)
    {
        try
        {
            var user = await _context.Users.FindAsync(userId);
            if (user == null)
            {
                return BadRequest("InvalidIndexError: User with such Id does not exist");
            }

            var role = await _context.Roles.FirstAsync(r => r.Name == roleName);
            if (role == null)
            {
                return BadRequest("InvalidNameError: Role with such name does not exist");
            }

            var project = await _context.Projects.FindAsync(projectId);
            if (project == null)
            {
                return BadRequest("InvalidIndexError: Project with such name does not exist");
            }

            var projectUsers = await GetProjectUsers(projectId);
            if (projectUsers.Any(pu => pu.Members.Any(m => m.RoleId == role.Id))) 
            {
                return BadRequest("DuplicateProjectMember: User with such Id already connected to selected project");
            }

            var addedEntityEntry = await _context.Members
                .AddAsync(new Member() { RoleId = role.Id, UserId = userId });
            var member = addedEntityEntry.Entity;

            await _context.SaveChangesAsync();


            return Created($"User connected successfully. Member Id: {member.Id}", member);
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    /// <summary>
    ///     Remove User from db by unique id
    /// </summary>
    /// <response code="200"> Just removed User </response>
    /// <response code="400"> InvalidIndexError: User with such Id does not exist </response>
    /// <response code="500"> Internal Server Error </response>
    [HttpDelete("{userId:int}")]
    public async Task<ActionResult<UserResponse>> DeleteUser(int userId)
    {
        try
        {
            var user = await _context.Users.FindAsync(userId);

            if (user == null)
            {
                return BadRequest("InvalidIndexError: User with such Id does not exist");
            }

            _context.Users.Remove(user);
            await _context.SaveChangesAsync();

            return UserResponse.ConvertFromModel(user);
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Internal Server Error: {ex.Message}");
        }
    }

    private async Task<List<User>> GetProjectUsers(int projectId)
    {
        return await _context.Users
            .Include(u => u.Members)
            .Where(u => _context.ProjectsMembers
                .Where(pm => pm.ProjectId == projectId)
                .Any(pm => u.Members.Any(m => m.Id == pm.MemberId)))
            .ToListAsync();
    }
}
```

#### Response для користувача

```cs
public class UserResponse
{
    public int Id { get; set; }

    public string Login { get; set; } = null!;

    public byte[] Picture { get; set; } = null!;

    public byte[] Password { get; set; } = null!;

    public string Email { get; set; } = null!;

    public string Role { get; set; } = null!;

    public static UserResponse ConvertFromModel(User user)
    {
        return new UserResponse()
        {
            Id = user.Id,
            Login = user.Login,
            Picture = user.Picture,
            Password = user.Password,
            Email = user.Email,
            Role = user.Role
        };
    }
}
```
